"use strict";(self.webpackChunkdyte_docs=self.webpackChunkdyte_docs||[]).push([[4310,3745],{4310:(e,t,a)=>{a.r(t),a.d(t,{dyte_livestream_player:()=>l});var i=a(5733),r=a(1237),s=a(4555),n=a(6633),o=a(336);a(804);const l=class{constructor(e){(0,i.r)(this,e),this.dyteAPIError=(0,i.c)(this,"dyteAPIError",7),this.showLatencyIndicator=!1,this.LoadPlayer=(e=this.ivsPlayer)=>{this.player&&e&&(e.attachHTMLVideoElement(this.player),e.setAutoplay(!0),e.setVolume(1))},this.livestreamUpdateListener=e=>{var t,a;this.livestreamState=e,"LIVESTREAMING"===e?(this.LoadPlayer(),this.getPlaybackUrl(),(null===(a=null===(t=this.meeting.__internals__)||void 0===t?void 0:t.browserSpecs)||void 0===a?void 0:a.isIOSMobile())||(this.fetchLatency(),this.updateLatency=setInterval(this.fetchLatency,2e3)),r.s.enableSource("livestream-player")):(this.showLatencyIndicator=!1,this.updateLatency&&clearInterval(this.updateLatency),r.s.disableSource("livestream-player"))},this.getLoadingState=()=>{let e="",t=!1,a=!1;switch(this.livestreamState){case"IDLE":e=this.t("livestream.idle"),t=!0,a=!1;break;case"STARTING":e=this.t("livestream.starting"),t=!0,a=!0;break;case"STOPPING":e=this.t("livestream.stopping"),t=!0,a=!0;break;case"LIVESTREAMING":this.playerState!==s.P.PLAYING&&(e=this.t("livestream.starting"),a=!0,t=!0);break;default:t=!1,e=this.t(""),a=!0}return{isLoading:t,loadingMessage:e,showIcon:a}},this.getErrorState=()=>{var e,t;let a=!1,i="";return"LIVESTREAMING"!==this.livestreamState?(a=!1,i=this.t(""),{isError:a,errorMessage:i}):(this.isSupported||(a=!0,i=this.t("livestream.error.not_supported")),this.playbackUrl||(a=!0,i=this.t("livestream.error.not_found")),this.playerError&&(a=!0,i=this.t(null!==(t=null===(e=this.playerError)||void 0===e?void 0:e.message)&&void 0!==t?t:"livestream.error.unknown")),{isError:a,errorMessage:i})},this.fetchLatency=()=>{this.ivsPlayer&&(this.latency=this.ivsPlayer.getLiveLatency())},this.stopRebuffer=e=>{this.ivsPlayer.setRebufferToLive(!1),this.latency=e,clearInterval(this.updateLatency),this.updateLatency=setInterval(this.fetchLatency,2e3)},this.resetSyncLivestream=()=>{const e=this.ivsPlayer.getLiveLatency();this.stopRebuffer(e),this.dyteAPIError.emit({trace:this.t("livestreamPlayer.rebuffer.error"),message:this.t("livestream.error.sync")})},this.syncLiveStream=()=>{clearInterval(this.updateLatency),this.latency=-1,this.ivsPlayer.setRebufferToLive(!0);const e=setTimeout(this.resetSyncLivestream,15e3);this.updateLatency=setInterval((()=>{const t=this.ivsPlayer.getLiveLatency();t<10&&(this.stopRebuffer(t),clearTimeout(e))}),1e3)},this.meeting=void 0,this.size=void 0,this.t=(0,o.u)(),this.iconPack=n.d,this.playbackUrl=void 0,this.isSupported=!0,this.playerState=s.P.IDLE,this.livestreamState="IDLE",this.playerError=void 0,this.latency=0,this.audioPlaybackError=!1}AddPlayerListeners(e=this.ivsPlayer){Object.values(Object.assign(Object.assign({},s.d),s.P)).forEach((t=>{s.e.includes(t)||null==e||e.addEventListener(t,(a=>{var i,r,n;t!==s.P.IDLE&&t!==s.P.PLAYING&&t!==s.d.ERROR&&t!==s.P.READY||(this.playerState=t),t===s.d.ERROR&&(this.playerError=a),t===s.P.IDLE&&e.isPaused()&&e.play(),t===s.d.AUDIO_BLOCKED&&(this.audioPlaybackError=!0),this.playerState!==s.P.PLAYING||(null===(r=null===(i=this.meeting.__internals__)||void 0===i?void 0:i.browserSpecs)||void 0===r?void 0:r.isIOSMobile())?this.showLatencyIndicator=!1:this.showLatencyIndicator=!0,this.meeting.__internals__.logger.info(`IVS.Player.${t}`,a),s.f.includes(t)&&(null===(n=this.meeting.__internals__.callStats)||void 0===n||n.ivsPlayerEvent(t,a))}))}))}getPlaybackUrl(e=this.ivsPlayer){this.playbackUrl=this.meeting.livestream.playbackUrl,this.playbackUrl&&e&&(e.load(this.playbackUrl),e.play())}onPlayerRef(e){this.player=e,r.s.addSource("livestream-player",this.player,!!this.playbackUrl),this.playbackUrl&&r.s.enableSource("livestream-player")}connectedCallback(){this.meetingChanged(this.meeting),window.onDyteLivestreamPlayer=e=>{e?(this.isSupported=!0,this.ivsPlayer=e,this.AddPlayerListeners(e),this.LoadPlayer(e),this.getPlaybackUrl(e)):this.isSupported=!1},this.sendLatencyToCallStats=setInterval((()=>{var e;this.fetchLatency(),null===(e=this.meeting.__internals__.callStats)||void 0===e||e.livestreamLatency(this.latency)}),1e4)}disconnectedCallback(){window.onDyteLivestreamPlayer=void 0,this.meeting.livestream.removeListener("livestreamUpdate",this.livestreamUpdateListener),clearInterval(this.sendLatencyToCallStats),this.ivsPlayer.load(""),this.ivsPlayer=void 0,this.player=void 0}async componentDidLoad(){const e=document.createElement("script");e.type="module",e.innerHTML="\n    import IVSPlayer from 'https://cdn.jsdelivr.net/npm/amazon-ivs-player@1.16.0/+esm'\n    let player = undefined;\n    if (IVSPlayer.isPlayerSupported) {\n      player = IVSPlayer.create({\n        wasmBinary:\n          'https://unpkg.com/amazon-ivs-player@1.11.0/dist/assets/amazon-ivs-wasmworker.min.wasm',\n        wasmWorker:\n          'https://unpkg.com/amazon-ivs-player@1.11.0/dist/assets/amazon-ivs-wasmworker.min.js',\n      });\n    }\n    window.onDyteLivestreamPlayer && window.onDyteLivestreamPlayer(player);\n    ",document.body.appendChild(e)}meetingChanged(e){null!=e&&(this.livestreamState=this.meeting.livestream.state,"LIVESTREAMING"===this.livestreamState&&(this.LoadPlayer(),this.getPlaybackUrl(),r.s.enableSource("livestream-player")),this.meeting.livestream.on("livestreamUpdate",this.livestreamUpdateListener))}render(){if(!(0,s.s)(this.meeting))return;const{isError:e,errorMessage:t}=this.getErrorState(),{isLoading:a,loadingMessage:r,showIcon:n}=this.getLoadingState();return(0,i.h)(i.H,null,(0,i.h)("div",{class:"player-container"},(0,i.h)("video",{ref:e=>this.onPlayerRef(e),playsInline:!0}),this.audioPlaybackError&&(0,i.h)("div",{class:"unmute-popup"},(0,i.h)("h3",null,this.t("audio_playback.title")),(0,i.h)("p",null,this.t("audio_playback.description")),(0,i.h)("dyte-button",{kind:"wide",onClick:()=>{this.player.muted=!1,this.audioPlaybackError=!1},title:this.t("audio_playback"),iconPack:this.iconPack,t:this.t},this.t("audio_playback"))),this.showLatencyIndicator&&(0,i.h)("div",{class:"latency-controls"},(this.latency>10||this.latency<0)&&(0,i.h)("div",{class:"sync-live-stream",onClick:this.syncLiveStream},-1===this.latency?(0,i.h)("dyte-spinner",{id:"icon",part:"spinner",iconPack:this.iconPack,t:this.t,size:"sm"}):this.t("livestream.skip"))),e&&(0,i.h)("div",{class:"loader"},(0,i.h)("dyte-icon",{icon:this.iconPack.warning,t:this.t}),(0,i.h)("p",null,t)),!e&&a&&(0,i.h)("div",{class:"loader"},n&&(0,i.h)("dyte-spinner",{id:"icon",part:"spinner",iconPack:this.iconPack,t:this.t,size:"md"}),(0,i.h)("p",null,r))))}static get watchers(){return{meeting:["meetingChanged"]}}};l.style=":host{line-height:initial;font-family:var(--dyte-font-family, sans-serif);font-feature-settings:normal;font-variation-settings:normal}p{margin:var(--dyte-space-0, 0px);padding:var(--dyte-space-0, 0px)}:host{margin-left:var(--dyte-space-2, 8px);margin-right:var(--dyte-space-2, 8px);display:flex;height:100%;width:100%;border-radius:var(--dyte-border-radius-md, 8px);--tw-bg-opacity:1;background-color:rgba(var(--dyte-colors-background-900, 26 26 26) / var(--tw-bg-opacity))}.player-container{position:relative;margin:var(--dyte-space-4, 16px);display:flex;flex-grow:1;align-items:center;justify-content:center;overflow:hidden;border-radius:var(--dyte-border-radius-md, 8px)}video{z-index:0;height:100%;width:100%;border-radius:var(--dyte-border-radius-md, 8px);border-width:var(--dyte-border-width-none, 0);border-style:none;--tw-bg-opacity:1;background-color:rgba(var(--dyte-colors-background-1000, 8 8 8) / var(--tw-bg-opacity))}.loader{position:absolute;z-index:10;height:100%;width:100%;--tw-bg-opacity:1;background-color:rgba(var(--dyte-colors-background-900, 26 26 26) / var(--tw-bg-opacity));display:flex;flex-direction:column;align-items:center;justify-content:center}p{margin-top:var(--dyte-space-1, 4px);margin-bottom:var(--dyte-space-1, 4px);font-size:16px;color:rgb(var(--dyte-colors-text-700, 255 255 255 / 0.64))}.latency-controls{position:absolute;bottom:var(--dyte-space-4, 16px);right:var(--dyte-space-4, 16px);z-index:20;display:flex;flex-direction:row;align-items:center}.sync-live-stream{cursor:pointer;border-radius:var(--dyte-border-radius-sm, 4px);--tw-bg-opacity:1;background-color:rgba(var(--dyte-colors-brand-500, 33 96 253) / var(--tw-bg-opacity));padding-left:var(--dyte-space-2, 8px);padding-right:var(--dyte-space-2, 8px);padding-top:var(--dyte-space-1, 4px);padding-bottom:var(--dyte-space-1, 4px);font-size:12px}.unmute-popup{position:absolute;z-index:30 !important;display:flex;width:var(--dyte-space-72, 288px);flex-direction:column;border-radius:var(--dyte-border-radius-md, 8px);--tw-bg-opacity:1;background-color:rgba(var(--dyte-colors-background-800, 30 30 30) / var(--tw-bg-opacity));padding:var(--dyte-space-4, 16px);text-align:center;max-width:70%}.unmute-popup h3{margin:var(--dyte-space-0, 0px);font-size:16px;font-weight:500}.unmute-popup p{margin-top:var(--dyte-space-3, 12px);margin-bottom:var(--dyte-space-3, 12px);font-size:14px}"}}]);