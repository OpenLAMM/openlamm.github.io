"use strict";(self.webpackChunkdyte_docs=self.webpackChunkdyte_docs||[]).push([[4667],{2515:(e,t,i)=>{i.d(t,{T:()=>n});var s=i(5733);function a(e){const t=/\*([^*]*)\*/g,i=/_([^_]*)_/g,s=/~([^~]*)~/g,a=/https?:\/\/(www\.)?[-a-zA-Z0-9@:%._\+~#=]{1,256}\.[a-zA-Z0-9()]{1,6}\b([-a-zA-Z0-9()@:%_\+.~#?&//=]*)/;let n=t.exec(e);for(;n;)e=e.replace(n[0],`<b>${n[1]}</b>`),n=t.exec(e);let r=i.exec(e);for(;r;)e=e.replace(r[0],`<i>${r[1]}</i>`),r=i.exec(e);let h=s.exec(e);for(;h;)e=e.replace(h[0],`<s>${h[1]}</s>`),h=s.exec(e);return e=(e=(e=e.split(" ").map((e=>{if(a.test(e)){const t=a.exec(e);return e.replace(t[0],`<a class="link" href="${t[0]}" target="_blank" rel="noopener noreferrer">${t[0]}</a>`)}return e})).join(" ")).split("\n").map((e=>e.split(" ").map(((e,t)=>">"!==e||0!==t&&">"!==e[t-1]?e:'<span class="block-quote"></span>')).join(" "))).join("\n")).split("\n").map((e=>`<p>${e}</p>`)).join("\n")}const n=({message:e})=>(0,s.h)("p",{innerHTML:a(e)})},7037:(e,t,i)=>{i.d(t,{T:()=>h,d:()=>a,e:()=>d,g:()=>n,h:()=>r,i:()=>c,p:()=>s,r:()=>o});i(5114);const s=e=>{let t=null;try{const i=JSON.parse(e.message),{target:s,message:a}=i;t=void 0===s||void 0===a?e:Object.assign(Object.assign({},e),{targetUserIds:s,message:a})}catch(i){t=e}return t};function a(e,t){return e.localeCompare(t)}function n(e){return e.sort(((e,t)=>e.localeCompare(t))).join("_")}function r(e,t){if(null!=e)for(const i of e)if("file"===i.kind){const e=i.getAsFile();i.type.startsWith("image/")?t("image",e):t("file",e)}}const h="dm__";function c(e){return e.isDirectMessage}function d(e){return[...new Set(e)].sort(a).join("<>")}function o(e){return e.split("").reverse().join("")}},4667:(e,t,i)=>{i.r(t),i.d(t,{dyte_chat:()=>p});var s=i(5733),a=i(6633),n=i(336),r=i(7037),h=i(5114),c=i(7637),d=i(2515),o=i(1285),l=(i(1237),i(4555),i(6503));i(804);const p=class{constructor(e){(0,s.r)(this,e),this.stateUpdate=(0,s.c)(this,"dyteStateUpdate",7),this.channelMap=new Map,this.disconnectMeeting=e=>{var t,i,s,a;this.isPrivateChatSupported()&&(null==e||e.participants.joined.removeListener("participantsUpdate",this.onParticipantUpdate),null==e||e.participants.joined.removeListener("participantLeft",this.onParticipantUpdate)),null===(t=null==e?void 0:e.chat)||void 0===t||t.removeListener("chatUpdate",this.chatUpdateListener),null===(i=null==e?void 0:e.chat)||void 0===i||i.removeListener("channelCreate",this.onChannelCreateOrUpdate),null===(s=null==e?void 0:e.chat)||void 0===s||s.removeListener("channelUpdate",this.onChannelCreateOrUpdate),null===(a=null==e?void 0:e.chat)||void 0===a||a.removeListener("channelMessageUpdate",this.onChannelCreateOrUpdate)},this.onParticipantUpdate=()=>{this.participants=this.meeting.participants.joined.toArray().filter((e=>0===this.privatePresetFilter.length||this.privatePresetFilter.includes(e.presetName))),this.selectedParticipant&&!this.participants.includes(this.selectedParticipant)&&(this.selectedParticipant=null,this.chatRecipientId=this.selectedGroup="everyone")},this.usePaginatedChat=()=>(0,c.u)(this.meeting),this.updateUnreadCountGroups=e=>{this.unreadCountGroups=Object.assign(Object.assign({},this.unreadCountGroups),e)},this.isPrivateChatSupported=()=>{var e,t,i;return!(0,c.u)(this.meeting)&&this.canPrivateMessage&&!this.disablePrivateChat&&"socket-service"===(null===(i=null===(t=null===(e=this.meeting)||void 0===e?void 0:e.__internals__)||void 0===t?void 0:t.features)||void 0===i?void 0:i.getFeatureValue("chat_socket_server"))},this.updateRecipients=e=>{if("string"==typeof e.detail)this.chatRecipientId="everyone",this.selectedParticipant=null;else{const{userId:t}=e.detail;this.chatRecipientId=t,this.selectedParticipant=this.participants.find((e=>e.userId===t))}if("everyone"!==this.chatRecipientId){const e=[this.chatRecipientId,this.meeting.self.userId],t=(0,r.g)(e);this.selectedGroup=t}else this.selectedGroup="everyone";this.updateUnreadCountGroups({[this.selectedGroup]:0})},this.isTextMessagingAllowed=()=>"everyone"===this.chatRecipientId?this.canSend&&this.canSendTextMessage:this.canPrivateMessage&&this.canSendPrivateTexts,this.isFileMessagingAllowed=()=>"everyone"===this.chatRecipientId?this.canSend&&this.canSendFiles:this.canPrivateMessage&&this.canSendPrivateFiles,this.onChannelChanged=e=>{e.detail.includes(r.T)?this.createDMChannel(e.detail.replace(r.T,"")):this.selectedChannelId=e.detail},this.createDMChannel=async e=>{this.creatingChannel=!0;const t=await this.meeting.chat.createChannel("Direct Message",[e],{visibility:"private",isDirectMessage:!0});this.creatingChannel=!1,this.selectedChannelId=t.id},this.onChannelCreateOrUpdate=e=>{e?this.channelMap.set(e.id,e):this.meeting.chat.channels.forEach((e=>this.channelMap.set(e.id,e)));const t=Array.from(this.channelMap.values()).filter((e=>!(0,r.i)(e))).sort(((e,t)=>(0,r.d)(e.displayName,t.displayName))),i=Array.from(this.channelMap.values()).filter(r.i).map((e=>Object.assign(Object.assign({},e),{displayName:this.getMemberDisplayName(e)}))),s=this.meeting.participants.all.filter((e=>{if(e.id===this.meeting.self.userId)return!1;const t=(0,r.e)([this.meeting.self.userId,e.id]);return i.every((e=>(0,r.e)(e.memberIds)!==t))})).map((e=>({id:`${r.T}${e.id}`,displayName:e.name,displayPictureUrl:e.picture,isDirectMessage:!0,unreadCount:0}))),a=[...i,...s].sort(((e,t)=>(0,r.d)(e.displayName,t.displayName)));this.channels=[...t,...a]},this.getMemberDisplayName=e=>{var t;let i;i=1===e.memberIds.length?e.memberIds[0]:e.memberIds[0]===this.meeting.self.userId?e.memberIds[1]:e.memberIds[0];const s=this.meeting.participants.all.find((e=>e.id===i));return null!==(t=null==s?void 0:s.name)&&void 0!==t?t:i},this.onNewMessageHandler=async e=>{const t=e.detail;this.isChatViewType?(await this.meeting.chat.sendMessageToChannel(t,this.selectedChannelId,this.replyMessage?{replyTo:this.replyMessage}:{}),this.replyMessage=null):this.meeting.chat.sendMessage(t,this.getRecipientPeerIds())},this.onEditMessageHandler=async e=>{var t,i;await(null===(i=null===(t=this.meeting)||void 0===t?void 0:t.chat)||void 0===i?void 0:i.editTextMessage(e.detail.id,e.detail.message,e.detail.channelId)),this.editingMessage=null},this.onSearchHandler=async e=>{this.searchQuery=e.detail},this.onSearchDismissed=()=>{this.searchQuery=""},this.onChannelCreateClicked=()=>{this.stateUpdate.emit({activeChannelCreator:!0}),l.s.activeChannelCreator=!0},this.meeting=void 0,this.config=o.d,this.size=void 0,this.iconPack=a.d,this.t=(0,n.u)(),this.disablePrivateChat=!1,this.privatePresetFilter=[],this.unreadCountGroups={},this.chatGroups={everyone:[]},this.selectedGroup="everyone",this.now=new Date,this.dropzoneActivated=!1,this.showLatestMessageButton=!1,this.canSend=!1,this.canSendTextMessage=!1,this.canSendFiles=!1,this.canPrivateMessage=!1,this.canSendPrivateTexts=!1,this.canSendPrivateFiles=!1,this.emojiPickerEnabled=!1,this.chatRecipientId="everyone",this.participants=[],this.selectedParticipant=void 0,this.channels=[],this.selectedChannelId=void 0,this.editingMessage=null,this.replyMessage=null,this.searchQuery="",this.creatingChannel=!1}connectedCallback(){this.meeting&&(this.meetingChanged(this.meeting),this.meeting&&!this.meeting.chat||this.isFileMessagingAllowed()&&(this.host.addEventListener("dragover",(e=>{e.preventDefault(),this.dropzoneActivated=!0})),this.host.addEventListener("dragleave",(()=>{this.dropzoneActivated=!1})),this.host.addEventListener("drop",(e=>{e.preventDefault(),this.dropzoneActivated=!1,(0,r.h)(e.dataTransfer.items,((e,t)=>{var i,s,a,n;switch(e){case"image":this.isFileMessagingAllowed()&&(null===(s=null===(i=this.meeting)||void 0===i?void 0:i.chat)||void 0===s||s.sendImageMessage(t,this.getRecipientPeerIds()));break;case"file":this.isFileMessagingAllowed()&&(null===(n=null===(a=this.meeting)||void 0===a?void 0:a.chat)||void 0===n||n.sendFileMessage(t,this.getRecipientPeerIds()))}}))}))))}onEditMessageInit(e){e.detail.flags.isReply?this.replyMessage=e.detail.payload:e.detail.flags.isEdit&&(this.editingMessage=e.detail.payload)}disconnectedCallback(){this.disconnectMeeting(this.meeting)}meetingChanged(e,t){var i,s,a,n,r,h;null!=t&&this.disconnectMeeting(t),e&&!e.chat||null!=e&&(this.canSend=e.self.permissions.chatPublic.canSend,this.canSendTextMessage=e.self.permissions.chatPublic.text,this.canSendFiles=e.self.permissions.chatPublic.files,this.canPrivateMessage=!(!(null===(i=e.self.permissions.chatPrivate)||void 0===i?void 0:i.canSend)&&!(null===(s=e.self.permissions.chatPrivate)||void 0===s?void 0:s.canReceive)),this.canSendPrivateTexts=!!(null===(a=e.self.permissions.chatPrivate)||void 0===a?void 0:a.text),this.canSendPrivateFiles=!!(null===(n=e.self.permissions.chatPrivate)||void 0===n?void 0:n.files),this.isChatViewType="CHAT"===e.meta.viewType,this.isChatViewType&&(this.onChannelCreateOrUpdate(),(null===(r=this.channels)||void 0===r?void 0:r.length)&&(this.selectedChannelId=this.channels[0].id)),this.initializeChatGroups(),this.chatGroups=Object.assign({},this.chatGroups),this.chatUpdateListener=({message:e})=>{e.channelId||(this.addToChatGroup(e),this.chatGroups=Object.assign({},this.chatGroups))},this.onParticipantUpdate(),this.usePaginatedChat()||null===(h=e.chat)||void 0===h||h.addListener("chatUpdate",this.chatUpdateListener),this.isPrivateChatSupported()&&(e.participants.joined.addListener("participantJoined",this.onParticipantUpdate),e.participants.joined.addListener("participantLeft",this.onParticipantUpdate)),this.isChatViewType&&(e.chat.addListener("channelCreate",this.onChannelCreateOrUpdate),e.chat.addListener("channelUpdate",this.onChannelCreateOrUpdate),e.chat.addListener("channelMessageUpdate",this.onChannelCreateOrUpdate)))}chatGroupsChanged(e){var t,i;if(!this.isPrivateChatSupported())return;const s={};for(const a in e){const n=null!==(t=h.c[a])&&void 0!==t?t:0;s[a]=e[a].filter((e=>"chat"==e.type&&e.message.time>n&&e.message.userId!==this.meeting.self.userId)).length,(a===(0,r.g)([this.meeting.self.userId,null===(i=this.selectedParticipant)||void 0===i?void 0:i.userId])||"everyone"===a&&null===this.selectedParticipant)&&(s[a]=0,h.c[a]=new Date)}this.updateUnreadCountGroups(s)}initializeChatGroups(){var e;null===(e=this.meeting.chat)||void 0===e||e.messages.forEach((e=>{this.addToChatGroup(e)}))}addToChatGroup(e){var t;const i=(0,r.p)(e);let s="everyone";if((null===(t=i.targetUserIds)||void 0===t?void 0:t.length)>0){const e=new Set([i.userId,...i.targetUserIds]);s=(0,r.g)(Array.from(e))}void 0===this.chatGroups[s]&&(this.chatGroups[s]=[]),this.chatGroups[s]=[...this.chatGroups[s],{type:"chat",message:i}]}getRecipientPeerIds(){let e=[];return"everyone"!==this.chatRecipientId&&(e=[this.selectedParticipant.id]),e}channelSwitchListener(e){this.onChannelChanged(e)}renderHeadlessComponents(){return(0,s.h)(s.F,null,(0,s.h)("dyte-dialog-manager",{meeting:this.meeting}),(0,s.h)("dyte-notifications",{meeting:this.meeting}))}renderComposerUI(){var e,t;if(this.isChatViewType&&0===this.channels.length)return null;if(this.isChatViewType&&""!==this.searchQuery)return null;const i={iconPack:this.iconPack,t:this.t,size:this.size},a={};return this.editingMessage?a.editMessage=this.editingMessage:this.replyMessage&&(a.replyMessage=this.replyMessage),(0,s.h)("dyte-chat-composer-ui",Object.assign({canSendTextMessage:this.isTextMessagingAllowed(),canSendFiles:this.isFileMessagingAllowed(),disableEmojiPicker:!!(null===(t=null===(e=this.meeting)||void 0===e?void 0:e.__internals__)||void 0===t?void 0:t.features.hasFeature(c.F.DISABLE_EMOJI_PICKER)),members:this.meeting.participants.all,prefill:a,onDyteNewMessage:this.onNewMessageHandler,onDyteEditMessage:this.onEditMessageHandler,onDyteEditCancelled:()=>this.editingMessage=null},i),this.replyMessage&&(0,s.h)("div",{class:"quoted-message-container",slot:"chat-addon"},(0,s.h)("div",{class:"quoted-message"},(0,s.h)(d.T,{message:this.replyMessage.message})),(0,s.h)("div",{class:"quoted-message"},(0,s.h)("dyte-icon",{"aria-label":this.t("dismiss"),class:"dismiss",icon:this.iconPack.dismiss,onClick:()=>this.replyMessage=null,iconPack:this.iconPack,t:this.t}))))}renderFullChat(){if(this.creatingChannel)return(0,s.h)("div",{class:"banner"},(0,s.h)("dyte-spinner",{size:"lg"}));if(0===this.channels.length)return(0,s.h)("div",{class:"banner"},(0,s.h)("dyte-icon",{icon:this.iconPack.create_channel_illustration,iconPack:this.iconPack,t:this.t,slot:"start",class:"create-channel-illustration"}),(0,s.h)("dyte-button",{iconPack:this.iconPack,t:this.t,kind:"wide",variant:"primary",size:"md",onClick:this.onChannelCreateClicked,class:"welcome-new-channel"},(0,s.h)("dyte-icon",{icon:this.iconPack.add,iconPack:this.iconPack,t:this.t,slot:"start"}),(0,s.h)("span",null,this.t("chat.new_channel"))));const e=this.channels.find((e=>e.id===this.selectedChannelId));return(0,s.h)("div",{class:"chat"},(0,s.h)("dyte-channel-header",{slot:"header",meeting:this.meeting,channel:e,onSearch:this.onSearchHandler,onSearchDismissed:this.onSearchDismissed}),""!==this.searchQuery&&(0,s.h)("dyte-chat-search-results",{meeting:this.meeting,query:this.searchQuery,channelId:this.selectedChannelId}),""===this.searchQuery&&(0,s.h)("dyte-chat-messages-ui-paginated",{meeting:this.meeting,size:this.size,iconPack:this.iconPack,t:this.t,selectedChannelId:this.selectedChannelId,selectedChannel:e}))}render(){var e,t;if(!this.meeting)return null;const i={iconPack:this.iconPack,t:this.t,size:this.size},a=null===(e=this.meeting)||void 0===e?void 0:e.self.userId,n=this.chatGroups[this.selectedGroup]||[];return(0,s.h)(s.H,null,this.isChatViewType&&this.renderHeadlessComponents(),(0,s.h)("div",{class:"chat-container"},this.isChatViewType&&(0,s.h)("dyte-channel-selector-ui",{channels:this.channels,onChannelChanged:this.onChannelChanged,selectedChannelId:this.selectedChannelId,showRecentMessage:!0},(0,s.h)("div",{class:"channel-selector-header",slot:"header"},(0,s.h)("dyte-logo",{meeting:this.meeting,config:this.config,t:this.t}),(0,s.h)("dyte-tooltip",{label:this.t("chat.new_channel"),iconPack:this.iconPack,t:this.t},(0,s.h)("dyte-button",{iconPack:this.iconPack,t:this.t,kind:"button",variant:"ghost",size:"md",onClick:this.onChannelCreateClicked,class:"channel-create-btn"},(0,s.h)("dyte-icon",{icon:this.iconPack.add,iconPack:this.iconPack,t:this.t}))))),(0,s.h)("div",{class:"chat"},this.isFileMessagingAllowed()&&(0,s.h)("div",{id:"dropzone",class:{active:this.dropzoneActivated},part:"dropzone"},(0,s.h)("dyte-icon",{icon:this.iconPack.attach,iconPack:this.iconPack,t:this.t}),(0,s.h)("p",null,this.t("chat.send_attachment"))),this.isPrivateChatSupported()&&(0,s.h)("dyte-chat-selector-ui",Object.assign({selfUserId:a,groups:this.participants,selectedGroupId:null===(t=this.selectedParticipant)||void 0===t?void 0:t.userId,unreadCounts:this.unreadCountGroups,onDyteChatGroupChanged:this.updateRecipients},i)),this.isChatViewType?this.renderFullChat():this.usePaginatedChat()?(0,s.h)("dyte-chat-messages-ui-paginated",{meeting:this.meeting,size:this.size,iconPack:this.iconPack,t:this.t}):(0,s.h)("dyte-chat-messages-ui",Object.assign({messages:n,selfUserId:a,selectedGroup:this.selectedGroup},i)),this.renderComposerUI())))}get host(){return(0,s.g)(this)}static get watchers(){return{meeting:["meetingChanged"],chatGroups:["chatGroupsChanged"]}}};p.style=":host{line-height:initial;font-family:var(--dyte-font-family, sans-serif);font-feature-settings:normal;font-variation-settings:normal}p{margin:var(--dyte-space-0, 0px);padding:var(--dyte-space-0, 0px)}:host{display:flex;height:100%;width:100%;flex-direction:column;font-size:14px;color:rgb(var(--dyte-colors-text-1000, 255 255 255))}h3{margin:var(--dyte-space-0, 0px);display:flex;height:var(--dyte-space-12, 48px);align-items:center;justify-content:center;font-size:16px;font-weight:400;color:rgb(var(--dyte-colors-text-900, 255 255 255 / 0.88));text-align:center}#dropzone{position:absolute;top:var(--dyte-space-0, 0px);right:var(--dyte-space-0, 0px);bottom:var(--dyte-space-0, 0px);left:var(--dyte-space-0, 0px);z-index:10;display:none;flex-direction:column;align-items:center;justify-content:center;--tw-bg-opacity:1;background-color:rgba(var(--dyte-colors-background-800, 30 30 30) / var(--tw-bg-opacity));color:rgb(var(--dyte-colors-text-700, 255 255 255 / 0.64))}#dropzone.active{display:flex;-webkit-animation:0.2s slide-up ease-in;animation:0.2s slide-up ease-in}dyte-chat-messages-ui,dyte-chat-messages-ui-paginated{flex:1 0 0}.chat-container{display:flex;height:100%;width:100%;flex-direction:row}.chat{display:flex;flex:1 1 0%;flex-direction:column}.banner{height:100%;width:100%;display:flex;flex-direction:column;align-items:center;justify-content:center}.banner .welcome-new-channel{width:var(--dyte-space-48, 192px)}.banner .create-channel-illustration{height:var(--dyte-space-40, 160px);width:var(--dyte-space-40, 160px)}.quoted-message-container{display:flex;justify-content:space-between;padding-left:var(--dyte-space-2, 8px);padding-right:var(--dyte-space-2, 8px);padding-top:var(--dyte-space-2, 8px);--tw-bg-opacity:1;background-color:rgba(var(--dyte-colors-background-900, 26 26 26) / var(--tw-bg-opacity));color:rgb(var(--dyte-colors-text-1000, 255 255 255))}.quoted-message-container .quoted-message{flex:1 1 0%;padding:var(--dyte-space-2, 8px);border-radius:var(--dyte-border-radius-sm, 4px);--tw-bg-opacity:1;background-color:rgba(var(--dyte-colors-background-1000, 8 8 8) / var(--tw-bg-opacity))}.quoted-message-container dyte-icon.dismiss{margin-left:auto;height:var(--dyte-space-5, 20px);width:var(--dyte-space-5, 20px);padding:var(--dyte-space-2, 8px);border-radius:var(--dyte-border-radius-md, 8px);color:rgb(var(--dyte-colors-text-600, 255 255 255 / 0.52))}.quoted-message-container dyte-icon.dismiss:hover{cursor:pointer;color:rgb(var(--dyte-colors-text-1000, 255 255 255))}.quoted-message-container dyte-icon.dismiss{transition-property:color, background-color, border-color, fill, stroke, -webkit-text-decoration-color;transition-property:color, background-color, border-color, text-decoration-color, fill, stroke;transition-property:color, background-color, border-color, text-decoration-color, fill, stroke, -webkit-text-decoration-color;transition-timing-function:cubic-bezier(0.4, 0, 0.2, 1);transition-duration:150ms}.channel-selector-header{height:var(--dyte-space-8, 32px);padding:var(--dyte-space-4, 16px);display:flex;justify-content:space-between}.channel-selector-header .channel-create-btn{width:var(--dyte-space-8, 32px);justify-content:center}.channel-selector-header .channel-create-btn:hover{--tw-text-opacity:1;color:rgba(var(--dyte-colors-brand-300, 73 124 253) / var(--tw-text-opacity))}"}}]);